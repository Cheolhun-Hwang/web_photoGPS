<!DOCTYPE html>
<html lang="kr">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SB Admin 2 - Bootstrap Admin Theme</title>

    <!-- Bootstrap Core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="../vendor/datatables-plugins/dataTables.bootstrap.css" rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="../vendor/datatables-responsive/dataTables.responsive.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- developer personal css -->
    <link href="./assets/css/index.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
    #datas>tr>td, th{
        vertical-align:middle;
        align-content: center;
        text-align: center;
    }
    #datas>tr>td:first-child{
        width: 4%;
        font-size: 0.8em;
    }
    #datas>tr>td:nth-child(2){
        width: 10%;
        font-size: 0.8em;
    }
    #datas>tr>td:nth-child(3){
        width: 15%;
        font-size: 0.8em;
    }
    #datas>tr>td:nth-child(4){
        width: 8%;
        min-width: 90px;
        font-size: 0.6em;
    }
    #datas>tr>td:nth-child(5){
        width: 10%;
        min-width: 90px;
        font-size: 0.6em;
    }
    #datas>tr>td:nth-child(6){
        width: 20%;
        font-size: 0.8em;
    }
    .imgs{
        width: 120px;
        height: 90px;
    }
    #pagination a {
        display:inline-block;
        margin-right:5px;
    }
    </style>
    

</head>

<body>

    <div id="wrapper">

        
        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Photo GPS v1.0.0</a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i> 000님 반간습니다. <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form col-md-12">
                                <div class="col-md-4" >
                                    <img id="uProfileImage" src="./assets/images/noimage.png" />
                                </div>
                                <div class="col-md-6">
                                    <h5>000 님</h5>
                                    <h9>[ 소속 - 직급]</h9>
                                </div>
                            </div>
                            <!-- /input-group -->
                        </li>
                        <li>
                            <a href="account.html"><i class="fa fa-user"></i> 계정관리</a>
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-group"></i> 인맥관리</a>
                        </li>
                        <li>
                            <a href="monitoring.html"><i class="fa fa-map-marker"></i> 실시간 모니터링</a>
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper" style="background-color:white;">


             <!-- Title  Layout -->


            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">실시간 모니터링</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->


            
             <!-- Contents Layout -->


            <div class="row">

                 <!-- left Table Layout -->


                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading col-md-12">
                            <div class="col-md-6" style="height:34px;">
                                <h8>모니터링 지역 : 경기도 성남시 수정구</h8>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <input id="input_table_filter" type="text" class="form-control" placeholder="Search for...">
                                    <span class="input-group-btn">
                                        <button id="button_table_filter" class="btn btn-default" type="button" onclick="tableFilter();">Filter</button>
                                    </span>
                                </div><!-- /input-group -->
                            </div>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="">
                            <table id="data_table" class="table table-striped table-bordered table-hover" style="width:100%;margin:0%;">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>소속</th>
                                        <th>접수자</th>
                                        <th>접수날짜</th>
                                        <th>분야</th>
                                        <th>현장사진</th>
                                    </tr>
                                </thead>
                                <tbody id="datas">
                                </tbody>
                            </table>
                            <!-- /.table-responsive -->
                            <!-- <div class="well">
                                <h4>DataTables Usage Information</h4>
                                <p>DataTables is a very flexible, advanced tables plugin for jQuery. In SB Admin, we are using a specialized version of DataTables built for Bootstrap 3. We have also customized the table headings to use Font Awesome icons in place of images. For complete documentation on DataTables, visit their website at <a target="_blank" href="https://datatables.net/">https://datatables.net/</a>.</p>
                                <a class="btn btn-default btn-lg btn-block" target="_blank" href="https://datatables.net/">View DataTables Documentation</a>
                            </div> -->
                        </div>
                        <!-- /.panel-body -->
                        <div align=center>
                            <nav>
                                <ul class="pagination" style="margin:1px;">
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-6 -->



                <!-- right Map Layout -->



                <div class="col-lg-6">
                    <div class="col-lg-12">
                        <ul class="nav navbar-top-links navbar-right">
                                <!-- /.dropdown -->
                                <li class="dropdown">
                                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                        <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-tasks">
                                        <li>
                                            <a href="#">
                                                <div>
                                                    <p>
                                                        <strong>안전 / 위험</strong>
                                                        <span class="pull-right text-muted">40 건</span>
                                                    </p>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="1000" style="width: 4%">
                                                            <span class="sr-only">40% Complete (success)</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="divider"></li>
                                        <li>
                                            <a href="#">
                                                <div>
                                                    <p>
                                                        <strong>주차 / 교통</strong>
                                                        <span class="pull-right text-muted">20 건</span>
                                                    </p>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="1000" style="width: 2%">
                                                            <span class="sr-only">20% Complete</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="divider"></li>
                                        <li>
                                            <a href="#">
                                                <div>
                                                    <p>
                                                        <strong>신규 설치</strong>
                                                        <span class="pull-right text-muted">60 건</span>
                                                    </p>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="1000" style="width: 6%">
                                                            <span class="sr-only">60% Complete (warning)</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="divider"></li>
                                        <li>
                                            <a href="#">
                                                <div>
                                                    <p>
                                                        <strong>보수요청</strong>
                                                        <span class="pull-right text-muted">80 건</span>
                                                    </p>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="1000" style="width: 8%">
                                                            <span class="sr-only">80% Complete (danger)</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="divider"></li>
                                        <li>
                                            <a href="#">
                                                <div>
                                                    <p>
                                                        <strong>환경 / 쓰레기</strong>
                                                        <span class="pull-right text-muted">80 건</span>
                                                    </p>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="1000" style="width: 8%">
                                                            <span class="sr-only">80% Complete (danger)</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="divider"></li>
                                        <li>
                                            <a href="#">
                                                <div>
                                                    <p>
                                                        <strong>기 타</strong>
                                                        <span class="pull-right text-muted">80 건</span>
                                                    </p>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="1000" style="width: 8%">
                                                            <span class="sr-only">80% Complete (danger)</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                    <!-- /.dropdown-tasks -->
                                </li>
                                <!-- /.dropdown -->
                                <li class="dropdown">
                                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                        <i class="fa fa-bell fa-fw" style="color:red;"></i> <span class="badge">1</span>  <i class="fa fa-caret-down" style="color:red"></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-messages">
                                            <li>
                                                <a href="#">
                                                    <div>
                                                        <strong>John Smith</strong>
                                                        <span class="pull-right text-muted">
                                                            <em>Yesterday</em>
                                                        </span>
                                                    </div>
                                                    <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                                                </a>
                                            </li>
                                            <li class="divider"></li>
                                            <li>
                                                <a href="#">
                                                    <div>
                                                        <strong>John Smith</strong>
                                                        <span class="pull-right text-muted">
                                                            <em>Yesterday</em>
                                                        </span>
                                                    </div>
                                                    <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                                                </a>
                                            </li>
                                            <li class="divider"></li>
                                            <li>
                                                <a href="#">
                                                    <div>
                                                        <strong>John Smith</strong>
                                                        <span class="pull-right text-muted">
                                                            <em>Yesterday</em>
                                                        </span>
                                                    </div>
                                                    <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                                                </a>
                                            </li>
                                            <li class="divider"></li>
                                            <li>
                                                <a href="#">
                                                    <div>
                                                        <strong>John Smith</strong>
                                                        <span class="pull-right text-muted">
                                                            <em>Yesterday</em>
                                                        </span>
                                                    </div>
                                                    <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                                                </a>
                                            </li>
                                            <!-- <li class="divider"></li> -->
                                            <!-- <li>
                                                <a class="text-center" href="#">
                                                    <strong>Read All Messages</strong>
                                                    <i class="fa fa-angle-right"></i>
                                                </a>
                                            </li> -->
                                        </ul>
                                    <!-- /.dropdown-alerts -->
                                </li>
                            </ul>
                            <!-- /.navbar-top-links -->
                        </div>
                    <div class="panel panel-default">
                        <div id="map" style="width:100%;height:743px;"></div>
                    </div>
                </div>
            </div>
            <!-- /.row -->
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="../vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="../vendor/metisMenu/metisMenu.min.js"></script>

    <!-- DataTables JavaScript -->
    <script src="../vendor/datatables/js/jquery.dataTables.min.js"></script>
    <script src="../vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
    <script src="../vendor/datatables-responsive/dataTables.responsive.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/sb-admin-2.js"></script>

    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB7-5FbtuQ5_3F1lQZPuy9afCyJwhmwqQM">
    </script>
    <!-- Page-Level Demo Scripts - Tables - Use for reference -->

    <script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
    <script>
        var dataArray=[];
        $(document).ready(function() {
            
            firebase_init(dataArray);

        });

        function firebase_init(dataArray){
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyDJn-l0na0j2OKYLiyfnizalBy785XoL8A",
                authDomain: "storagefirebase-45eef.firebaseapp.com",
                databaseURL: "https://storagefirebase-45eef.firebaseio.com",
                projectId: "storagefirebase-45eef",
                storageBucket: "storagefirebase-45eef.appspot.com",
                messagingSenderId: "667190904245"
            };
            firebase.initializeApp(config);

            var database = firebase.database();
            
            database.ref('service').on('value', function(snapshop){
                if(snapshop.val() == null){
                    alert('Database null... Firebase Check');
                }else{
                    snapshop.forEach(function(child){
                        var item = new Object();
                        item.lat =  child.val().lat;
                        item.lon = child.val().lon;
                        item.uAddress = child.val().uAddress;
                        item.uContext = child.val().uContext;
                        item.uField = child.val().uField;
                        item.uImageUrl = child.val().uImageUrl;
                        item.uName = child.val().uName;
                        item.uRank = child.val().uRank;
                        item.uUploadDate = child.val().uUploadDate;
                        item.uid = child.val().uid;

                        dataArray.push(item);
                        addRow('datas', item);
                    });

                    initMap(dataArray);
                    pagination();
                }
            });
        }

        function addRow(tableid, target) {
            var table = document.getElementById(tableid);
            var rowlen = table.rows.length;
            var before = table.innerHTML;

            var after = '<tr onclick="rowClick('+rowlen+');">'+'<td>'+(rowlen+1)+'</td>'+
                        '<td>'+target.uRank+'</td>'+
                        '<td>'+target.uName+'</td>'+
                        '<td>'+target.uUploadDate+'</td>'+
                        '<td>'+target.uField+'</td>'+
                        '<td>'+'<img class="imgs" src="'+target.uImageUrl+'" />'+'</td></tr>';

            table.innerHTML = after+before;
        }

        function rowClick(index){
            alert(index);
        }

        function initMap(locations) {
            var kor = {lat: 37.335887, lng: 126.584063};

            // Create an array of alphabetical characters used to label the markers.
            var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';


            var iconBase = 'assets/images/';
            var icons = {
                safe_danger: {
                    icon: new google.maps.MarkerImage(iconBase + 'safe_danger_marker.png',new google.maps.Size(71, 71),
                    new google.maps.Point(-14, -14),new google.maps.Point(17, 34), new google.maps.Size(45, 45))
                },
                green: {
                    icon: new google.maps.MarkerImage(iconBase + 'green_marker.png',new google.maps.Size(71, 71),
                    new google.maps.Point(-14, -14),new google.maps.Point(17, 34), new google.maps.Size(45, 45))
                },
                new: {
                    icon: new google.maps.MarkerImage(iconBase + 'new_marker.png',new google.maps.Size(71, 71),
                    new google.maps.Point(-14, -14),new google.maps.Point(17, 34), new google.maps.Size(45, 45))
                },
                parking: {
                    icon: new google.maps.MarkerImage(iconBase + 'parking_marker.png',new google.maps.Size(71, 71),
                    new google.maps.Point(-14, -14),new google.maps.Point(17, 34), new google.maps.Size(45, 45))
                },
                req: {
                    icon: new google.maps.MarkerImage(iconBase + 'req_marker.png',new google.maps.Size(71, 71),
                    new google.maps.Point(-14, -14),new google.maps.Point(17, 34), new google.maps.Size(45, 45))
                },
                etc: {
                    icon: new google.maps.MarkerImage(iconBase + 'etc_marker.png',new google.maps.Size(71, 71),
                    new google.maps.Point(-14, -14),new google.maps.Point(17, 34), new google.maps.Size(45, 45))
                }
            };

            if(locations.length <1){
                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 9,
                    center: kor
                });
                var marker = new google.maps.Marker({
                    position: kor,
                    map: map
                });
            }else{
                var markers=[];
                for(var i=0; i<locations.length;i++){
                    var item = locations[i];
                    if(i == 0){
                        var gps = {lat: item.lat, lng: item.lon};
                        var map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 13,
                            center: gps
                        });
                    }

                    
                    var image = '';

                    if(item.uField.replace(/ /gi, "").includes('기타')){
                        image = icons.etc.icon;
                    }else if(item.uField.replace(/ /gi, "").includes('환경')){
                        image = icons.green.icon;
                    }else if(item.uField.replace(/ /gi, "").includes('보수요청')){
                        image = icons.req.icon;
                    }else if(item.uField.replace(/ /gi, "").includes('신규')){
                        image = icons.new.icon;
                    }else if(item.uField.replace(/ /gi, "").includes('주차')){
                        image = icons.parking.icon;
                    }else if(item.uField.replace(/ /gi, "").includes('안전')){
                        image = icons.safe_danger.icon;
                    }

                    var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(item.lat, item.lon),
                        icon: image
                    });

                    marker.addListener('click', function() {
                        alert("Marker");
                    });
                    markers.push(marker);
                }
                
                // Add a marker clusterer to manage the markers.
                var markerCluster = new MarkerClusterer(map, markers,
                    {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
                }

                markerCluster.addListener('click', function(){
                    alert('cluster');
                });
                
            }

            //Table Pager...........
            function pagination(){
                var req_num_row=6;
                var $tr=jQuery('#datas tr');
                var total_num_row=$tr.length;
                var num_pages=0;
                if(total_num_row % req_num_row ==0){
                    num_pages=total_num_row / req_num_row;
                }
                if(total_num_row % req_num_row >=1){
                    num_pages=total_num_row / req_num_row;
                    num_pages++;
                    num_pages=Math.floor(num_pages++);
                }
                for(var i=1; i<=num_pages; i++){
                    jQuery('.pagination').append('<li><a href="#">'+i+'</a></li>');
                }
                $tr.each(function(i){
                    jQuery(this).hide();
                    if(i+1 <= req_num_row){
                        $tr.eq(i).show();
                    }
                
                });
                jQuery('.pagination a').click(function(e){
                    e.preventDefault();
                    $tr.hide();
                    var page=jQuery(this).text();
                    var temp=page-1;
                    var start=temp*req_num_row;
                    //alert(start);
                    
                    for(var i=0; i< req_num_row; i++){
                        
                        $tr.eq(start+i).show();
                    
                    }
                });
            }

            //search Function
            function tableFilter() {
                // Declare variables 
                var input, filter, table, paging;
                input = document.getElementById("input_table_filter");
                filter = input.value.toUpperCase().replace(/ /gi, "");
                table = document.getElementById('datas');
                paging = document.getElementsByClassName('pagination');

                if(filter){
                    table.innerHTML = "";
                    for(var i = 0 ; i< dataArray.length;i++){
                        var row = dataArray[i];
                        if(row.uField.toUpperCase().replace(/ /gi, "").includes(filter) ||
                            row.uRank.toUpperCase().replace(/ /gi, "").includes(filter) ||
                            row.uName.toUpperCase().replace(/ /gi, "").includes(filter) ||
                            row.uUploadDate.toUpperCase().replace(/ /gi, "").includes(filter)){
                           
                            addRow('datas', row);
                        }
                    }

                    paging[0].innerHTML = "";
                    pagination();
                }else{
                    table.innerHTML = "";
                    for(var i = 0 ; i< dataArray.length;i++){
                        addRow('datas', dataArray[i]);
                    }
                    paging[0].innerHTML = "";
                    pagination();
                }
                
            }


        </script>
</body>

</html>
